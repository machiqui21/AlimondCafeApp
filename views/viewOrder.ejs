<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Order #<%= (header && (header.OrderID || header.ID)) %></title>
  <link rel="stylesheet" href="/menu.css">
</head>
<body>
  <header class="hero">
    <img class="logo" src="/images/AlimondsCafe.jpeg">
    <h1>Order #<%= (header && (header.OrderID || header.ID)) %></h1>
    <h3><%= header && header.StatusDescription ? header.StatusDescription : 'Pending' %></h3>
  </header>

  <main style="max-width: 900px; margin: 16px auto;">
    <section style="background:#fff; border-radius:8px; padding:12px 16px; box-shadow:0 2px 12px rgba(0,0,0,0.06);">
      <div style="display:flex; gap:16px; flex-wrap:wrap;">
        <div><strong>Customer:</strong> <%= header && header.CustomerName || '-' %></div>
        <div><strong>Date:</strong> <%= header && (header.CreatedAt || header.Created_at || header.created_at) %></div>
        <div><strong>Total:</strong> â‚±<%= (parseFloat(header && header.TotalAmount || 0)||0).toFixed(2) %></div>
        <% if (header && header.PaymentMethod) { %>
          <div><strong>Payment:</strong> <span style="color:#16a34a; font-weight:600;"><%= header.PaymentMethod %></span></div>
        <% } %>
      </div>
    </section>

    <% if (header && header.PaymentMethod === 'Cash' && header.StatusDescription === 'Pending') { %>
      <section style="margin-top:16px; background:#fff3cd; border-left:4px solid #ffc107; padding:16px; border-radius:8px; box-shadow:0 2px 12px rgba(0,0,0,0.06);">
        <p style="margin:0; color:#856404; font-size:1.1rem; font-weight:500;">
          ðŸ’µ <strong>Thank you!</strong> Please proceed to the cashier to complete your payment.
        </p>
      </section>
    <% } %>

    <% if (typeof qrCodeDataUrl !== 'undefined' && qrCodeDataUrl) { %>
      <section style="margin-top:16px; background:#fff; border-radius:8px; padding:16px; box-shadow:0 2px 12px rgba(0,0,0,0.06); text-align:center;">
        <h3 style="margin-top:0; color:#7c4700;">Scan to Pay</h3>
        <img src="<%= qrCodeDataUrl %>" alt="Payment QR Code" style="max-width:300px; border:2px solid #e5e7eb; border-radius:8px; padding:8px;"/>
        <p style="margin-top:12px; color:#666;">
          Scan this QR code with your payment app<br/>
          <strong>Account:</strong> 09265363860<br/>
          <strong>Amount:</strong> â‚±<%= (parseFloat(header && header.TotalAmount || 0)||0).toFixed(2) %><br/>
          <strong>Order ID:</strong> #<%= (header && (header.OrderID||header.ID)) %>
        </p>
      </section>
    <% } %>

    <section style="margin-top:16px;">
      <table class="menu-table" style="width:100%;">
        <thead>
          <tr>
            <th>#</th>
            <th>Product</th>
            <th>Qty</th>
            <th>Price/Item</th>
            <th>Line Total</th>
          </tr>
        </thead>
        <tbody>
          <% (items||[]).forEach(function(it, idx){ %>
            <tr>
              <td><%= idx+1 %></td>
              <td>
                <%= it.ProductName || ('#'+(it.ProductID||'')) %>
                <% if (it.Size) { %><br/><small>Size: <%= it.Size %></small><% } %>
              </td>
              <td><%= it.Quantity || it.qty || 1 %></td>
              <td>â‚±<%= (parseFloat(it.UnitPrice||it.Price||0)||0).toFixed(2) %></td>
              <td>â‚±<%= (parseFloat(it.Subtotal||it.LineTotal||0)||0).toFixed(2) %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </section>

    <section style="margin-top:16px; display:flex; gap:16px; flex-wrap:wrap;">
      <% var opts = optionsByType || {}; %>
      <div style="flex:1 1 260px; background:#fff; padding:12px 16px; border-radius:8px; box-shadow:0 2px 12px rgba(0,0,0,0.06);">
        <h3>Sweetener</h3>
        <% if (opts.Sweetener && opts.Sweetener.length) { %>
          <ul>
            <% opts.Sweetener.forEach(function(o){ %>
              <li><%= o.name %> <small>(â‚±<%= (parseFloat(o.price||0)||0).toFixed(2) %>)</small></li>
            <% }); %>
          </ul>
        <% } else { %>
          <div class="empty">None</div>
        <% } %>
      </div>

      <div style="flex:1 1 260px; background:#fff; padding:12px 16px; border-radius:8px; box-shadow:0 2px 12px rgba(0,0,0,0.06);">
        <h3>Milk</h3>
        <% if (opts.Milk && opts.Milk.length) { %>
          <ul>
            <% opts.Milk.forEach(function(o){ %>
              <li><%= o.name %> <small>(â‚±<%= (parseFloat(o.price||0)||0).toFixed(2) %>)</small></li>
            <% }); %>
          </ul>
        <% } else { %>
          <div class="empty">None</div>
        <% } %>
      </div>

      <div style="flex:1 1 260px; background:#fff; padding:12px 16px; border-radius:8px; box-shadow:0 2px 12px rgba(0,0,0,0.06);">
        <h3>Toppings</h3>
        <% if (opts.Topping && opts.Topping.length) { %>
          <ul>
            <% opts.Topping.forEach(function(o){ %>
              <li><%= o.name %> <small>(â‚±<%= (parseFloat(o.price||0)||0).toFixed(2) %>)</small></li>
            <% }); %>
          </ul>
        <% } else { %>
          <div class="empty">None</div>
        <% } %>
      </div>
    </section>

    <div style="margin-top:16px; display:flex; gap:12px;">
      <a class="btn" href="/menu">Back to Menu</a>
      <a class="btn" href="/">Back to Homepage</a>
    </div>
  </main>
  
  <button onclick="toggleDarkMode()" style="position: fixed; bottom: 20px; right: 20px; padding: 12px 20px; background: #8b5a3c; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 1000;">ðŸŒ™ Toggle Dark Mode</button>

  <script>
    function toggleDarkMode() {
      var isDark = document.body.classList.toggle('dark-mode');
      try { localStorage.setItem('darkMode', isDark ? '1' : '0'); } catch(e) {}
    }
    
    // Restore saved dark mode preference
    (function() {
      try {
        var saved = localStorage.getItem('darkMode');
        if (saved === '1') document.body.classList.add('dark-mode');
      } catch(e) {}
    })();
  </script>
</body>
</html>
